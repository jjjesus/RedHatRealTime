\documentclass[12pt]{article}

\usepackage{array} % table right-justify
%\usepackage{beramono} % listing monospace font
\usepackage{caption}
\usepackage{changepage} % adjustwidth
\usepackage{colortbl} %
\usepackage{enumitem} %
\usepackage{xcolor}
\usepackage{float}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{listings} % Code listings
\usepackage{lmodern} % better tt fonts
\usepackage{multicol}
\usepackage{multirow}
\usepackage{textcomp}
\usepackage{xurl}
\usepackage{setspace}
\usepackage{etoolbox}

\AtBeginEnvironment{quote}{\singlespacing\small}
%\AtBeginEnvironment{quote}{\small}

\usepackage[utf8]{inputenc}
\usepackage{setspace}

\usepackage[dvips,letterpaper,margin=1in]{geometry}

\setlength{\parindent}{15pt}
\setlength{\headheight}{15pt} % fancyhdr wants at least 14.5pt
\setlist{noitemsep}

\definecolor{light-gray}{gray}{0.95}

% Header
\pagestyle{fancy}
%\lhead{K3 Migration to Red Hat Real-Time Linux}
\lhead{Working title}
\rhead{August 28, 2020}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Start document
\begin{document}

%%%%%%%%%%%%%%%%%%%% Title Page %%%%%%%%%%%%%%%%%%%%%%%%
\thispagestyle{empty}
\begin{titlepage}
\begin{center}
        \vspace*{1cm}

        %\LARGE{Ku Band Radio Frequency System Version 3 (K3) \\
        %Migration from Concurrent RedHawk Linux to \\
        %Red Hat Real-Time Linux}
        \LARGE{Working Title}

        \vspace{0.5cm}
        \LARGE
        % Subtitle

        \vspace{1.5cm}

        \normalsize

        John Jesus \\
        August 28, 2020

        \vfill



        \vspace{0.8cm}




\end{center}
\end{titlepage}

\tableofcontents

%%%%%%%%%%%%%%%%% Scope %%%%%%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Scope}
\subsection{Identification}
This document is a Raytheon internal document analyzing an opportunity to change
the version of Linux operating system used in the Ku Band Radio Frequency System
(KRFS) Version 3 (K3).

\subsection{System overview}
KRFS is a radar system that supports the counter- rocket, artillery, and mortar
(CRAM) mission.  KRFS has four radar apertures each operating as an Active
Electronically Scanned Array (AESA).  Each aperture has its own receiver/exciter
and signal processing subsystem called the Array Backend Electronics Unit
(ABEU).  The arrays are arranged to provide 360 degree coverage in azimuth and
horizon to 90-degree coverage in elevation.

\begin{figure}[H]
    \begin{center}
    \includegraphics[width=1.0\textwidth]{img/k3}
    \caption{K3 Radar System}
    \label{fig:k3}
    \end{center}
\end{figure}

The System Controller Unit (SCU) is a 3-U VPX/VME shelf with
commercial-off-the-self (COTS) cards and one custom card assembly (CCA).  The
SCU is the central controller for the radar system, and the main control
software within the SCU runs in its SBC card (Figure \ref{fig:scu}).

\begin{figure}[H]
    \begin{center}
    \includegraphics[width=1.0\textwidth]{img/scu}
    \caption{The SBC card in the SCU}
    \label{fig:scu}
    \end{center}
\end{figure}

In KRFS K2, the SBC Processor is a Extreme Engineering (XES) Xpedite7672 card
based on the Xeon-D System-on-a-Chip (SOC) running the Linux operating system.
In KRFS K3, the SBC Processor is a very similar Extreme Engineering (XES)
Xpedite7674 card also based on the Xeon-D SOC and running the Linux operating
system.

\subsection{Overview of Linux operating system and real-time features}
The Linux operating system is a free, open-source software (FOSS) operating
system originally authored by Linus Torvalds in September 1991 as a Unix system
for his personal computer.  Linux eventually became the operating system
underlying platforms from the smallest devices (Android phones are based on
Linux) to supercomputers. Although the source code for the software is freely
available, some commercial vendors charge fees to provide the software
pre-compiled for a particular device, board, or machine, and charge for support
and additional documentation or other tools.  Linux initially resembled the Unix
systems of its time; it supported multiple users and multiple simultaneously
running programs and used a \emph{completely fair scheduler} (CFS) to insure
equality among the running processes.

\subsubsection{Real-time patch (RT Patch) for the Linux operating system}
\label{section:rt_patch}
In the early 2000s, engineers at IBM and Red Hat were working on modifying the
Linux kernel source code to support real-time applications.  In a real-time
system like a radar, some processing has deadlines, for example, transmitting
pulses or processing signal returns, where instead of emphasizing fair
scheduling among all processes, a real-time operating system (RTOS) must assign
priorities to tasks and interrupt (preempt) not only the currently running task
but even its own internal mechanisms (spinlocks, semaphores, and interrupt
handling) to meet the real-time deadlines.  This patch was originally named
\emph{PREEMPT\_RT} or \emph{CONFIG\_PREEMPT\_RT} and authored by some of the most
important Linux kernel developers, Ingo Molnar and Thomas Gleixner of Red Hat
and Paul McKenny of IBM.  The source code for the RT Patch has been actively
maintained separately from the mainline Linux source code over the last 15 years
by teams led by these same developers and has been downloaded and incorporated
in thousands of systems and other Linux software distributions.

Some other features of the RT Patch besides kernel-level preemption:

\begin{enumerate}
\item CPU shielding - this mechanism constrains the running of operating system
threads to certain CPUs in a multicore/multiprocessor system.  KRFS uses this
feature to protect or \emph{shield} certain CPUs from running Linux kernel
lower-priority operations and lower-priority interrupts (such as disk I/O) so
that the shielded CPUs can be dedicated to real-time application (radar
processing) code.
\item CPU affinity - this mechanism enables application workload to be spread
among multiple CPUs to exploit concurrent processing.  This assignment of
application processes to \emph{cpusets} is specified in userspace (that is, the
application programmer decides this partitioning).  In KRFS, signal processing
application threads can be distributed among shielded CPUs so dedicated and
network communications can be partitioned onto other cores/CPUs.
\end{enumerate}

\subsubsection{Red Hat Real-Time Products}
The first announcement of Red Hat using their RT Patch work in their own
products was in February 2007 when IBM and Raytheon IDS of Tewksbury, MA
announced at the Boston 2007 Red Hat Summit that Red Hat real-time kernels were
running on IBM Blade Server computing clusters for the DDG 1000 Zumwalt Class
Destroyer Program.%
\footnote{https://www-03.ibm.com/press/us/en/pressrelease/21033.wss}

Later in 2007, Red Hat announced their Red Hat Messaging-Real-time-Grid (MRG)
product which bundled the real-time kernel with low-latency messaging components
and grid computing (\emph{grid computing} allows Linux to automatically spread
workload across any available CPU in a distributed cluster of machines).  In
this MRG product, Red Hat seemed to be ignoring customers who were interested in
real-time but did not need the enterprise cluster computing features, namely,
embedded systems developers.

When Red Hat released Red Hat Enterprise Linux 7 (RHEL7) in 2014, the MRG
product was deprecated, and \emph{Red Hat for Real-Time} was introduced as a
separate product.  Red Hat RT includes the standard Linux kernel with the RT
patch plus the Red Hat \emph{Tuna} tuning tool and other miscellaneous tools and
documentation, aiming this product at the embedded systems market.

\subsubsection{SuSE Linux Enterprise Real Time}
Soon after IBM and Red Hat released the original Linux RT Patch in the early
2000s, German firm \emph{Software und System-Entwicklung} (SuSE) released
\emph{SuSE Linux Enterprise Real Time} which included the RT Patch and added
some features:

\begin{enumerate}
\item Shield command - SuSE introduced a small python script to simplify the use
of the Linux \emph{cpuset} command for confining kernel and user processes to
certain processors (this script eventually moved to the main RT Patch)
\item Support for a Real-Time Clock and Interrupt Module (RCIM) - a PCI card
that provided programmable timers and 12 input and output external interrupt
lines to synchronize clocks across systems.  SuSE provided Linux device drivers
for this card.
\item A Frequency Based Scheduler (FBS) - SuSE provided a scheduler based on
the high-resolution timer provided by the RCIM to support software that
performed high-frequency short-deadline processing.  SuSE also released a
debugging tool providing a view of system utilization during each frequency
slice of the scheduler.
\end{enumerate}
\label{ref:suse_rt_features}

Although SuSE implied that they had implemented the real-time kernel features,
they were simply including the RT Patch code from Red Hat; Red Hat remarked of
the SuSE offering:

\begin{quote}
"With their latest release, (SuSE) has moved to the Red Hat-developed real-time
patch set," Che said. "If you look at it from a technology standpoint, (SuSE)
has moved to a version aligned with what Red Hat is doing. It validates our
approach that you have to work with the upstream Linux kernel." At the London
launch of MRG, line of business VP Scott Crenshaw said that (SuSE) had used beta
versions of Red Hat's code in its offering. "They haven't contributed a line of
code", he said. As a result of this change of code, he argued that "all their
prior users are cut off" from previous versions.%
\footnote{\url{http://www.internetnews.com/dev-news/article.php/3714366}}
\end{quote}


\subsubsection{Concurrent Computing Corporation RedHawk Linux}

In April 2004, Concurrent Computing Corporation announced a real-time
Linux product, containing this excerpt:

\begin{quote}
Concurrent's refinements include kernel-level priority inheritance support,
a Frequency Based Scheduler (FBS), process and IRQ shielding extensions,
user-level real-time Hyper-Treading control for Intel Xeon platforms,
user-level spin locks, significant real-time performance tuning and
many additional improvements.%
\footnote{\url{https://www.businesswire.com/news/home/20040427005101/en/Concurrent-Announces-Version-2.1-RedHawk-Real-Time-Linux}}
\end{quote}

It seems fairly obvious that this list of so-called \emph{Concurrent's refinements}
are simply features inherited from SuSE Real-Time, and, this comment from the Linux
Weekly News online was representative of many in the Linux community to
Concurrent's product announcement:

\begin{quote}
Parent article: Concurrent releases RedHawk Linux 2.1
They do not have to release source to the world, but,
they certainly do have the obligation to make source
available to those to whom they're distributing these
customized Linux kernels. The company seems to be very quiet on these
obligations, to judge from their web site. I think it's entirely
appropriate that they get some scrutiny from the folks
whose code they've customized.%
\footnote{\url{https://lwn.net/Articles/82589/}}
\end{quote}

At the same time as its repackaging of RT Patch, Concurrent released a set of
tools called \emph{NightStar} that are especially good in tracing the processing
of data as it travels between boards and over networks:

\begin{quote}
The RedHawk NightStar Tools allow users on an iHawk system running
RedHawk Linux to schedule, monitor, debug and analyze the run time behavior of
their real-time applications as well as the RedHawk Linux operating system
kernel.  The RedHawk NightStar Tools consist of the NightTrace event analyzer;
the NightSim frequency-based scheduler; the NightProbe data monitoring tool; the
NightView symbolic debugger; the NightTune system and application tuner;
shmdefine, a shared memory configuration aid tool; and the Data Monitoring API
(Datamon).  NightTrace is a graphical tool for analyzing the dynamic behavior of
single and multiprocessor applications. NightTrace can log application data
events from simultaneous processes executing on multiple CPUs or even multiple
systems. NightTrace combines application events with RedHawk Linux kernel
events, presenting a synchronized view of the entire system.  Many of the tools
include a small run-time agent that executes on the RedHawk Linux target system
in a non-intrusive manner, preserving the deterministic characteristics of the
application.%
\footnote{\emph{RedHawk NightStar Tools Version 2.2 Release Notes March 2005
0898008-2.2}, March 2005}
\end{quote}

Though the excerpt above was over fifteen years ago, the product features have
not changed, the products instead progressing by moving along with the mainline
kernel version and RT Patch and porting to new boards/platforms.

\subsubsection{Merge of RT Patch to Linux mainline in July 2019}
In July 2019, Linux Torvalds merged the RT Patch into the Linux mainline and the
latest Linux kernel can now be made real-time using a configuration option.%
\footnote{Linus Torvald's commit message is included in its entirety in Appendix
A}
This merge means that anyone can download the latest Linux kernel source and
build it to include all of the real-time features.

\subsubsection{Summary of Linux real-time options}

\begin{enumerate}
    \item Each of the real-time kernels offered from Red Hat, RedHawk, and SuSE
is the same as the others, merged from the RT Patch originally contributed and
currently maintained by Red Hat developers
    \item Though it has not changed its Red Hawk or NightStar feature set in 15
years, Concurrent's NightStar tools are very useful for distributed real-time
systems
    \item Red Hat has always had a real-time kernel product, but, it was
obscured by the enterprise cluster features with which it was packaged within
the Red Hat's MRG product, effectively hiding Red Hat's real-time kernel from
consideration by embedded systems developers.
    \item When Red Hat released Red Hat Enterprise Linux 7 (RHEL7) in 2014, the
MRG product was deprecated, and \emph{Red Hat for Real-Time} was introduced as a
separate product.  Red Hat RT includes the standard Linux kernel with the RT
patch plus the Red Hat \emph{Tuna} tuning tool and other miscellaneous tools and
documentation, aiming this product at the embedded systems market.
    \item The RT Patch was merged into the Linux Kernel mainline in July 2019
and thus available to anyone who downloads and builds the kernel source code
\end{enumerate}



\subsection{Document purpose}
%To integrate NE software, we need to be able to build Linux from source.  NE
%currently uses Red Hat Real-Time.  We use Red Hawk from Concurrent RTI.  NE
%builds from source using tools from Red Hat.  We do not build from source.
%
%Produce a document that helps us decide how to get our Linux image created.


\subsection{Document overview}
The structure of this document:

\begin{enumerate}
    \item Document scope (this section)
    \item References
    \item Real-time features from RedHawk used in current KRFS software
    \item Creating the Linux operating system image
    \item Hardening the Linux operating system image
    %\item Migrating to Red Hat Real-Time in K3
\end{enumerate}



%%%%%%%%%%%%%%%%% References %%%%%%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{References}

\begin{enumerate}
    \item \textit{RedHawk Linux Users Guide 0898004-780} (Concurrent Computer
Corporation, March 2016) \label{ref:red_hawk_guide}
    \item \textit{RedHawk Architect Users Guide 0898601-7.2-1} (Concurrent
Computer Corporation, December 2016) \label{ref:architect}
    \item \textit{NightStar RT Tutorial Version 4.4 0898009-090} (Concurrent
Computer Corporation, May 2014) \label{ref:nightstar}
    \item \textit{Red Hat Enterprise Linux for Real Time 7 Reference Guide} (Red
Hat Corporation, November 6, 2015) \label{ref:rhel7_ref}
    \item \textit{Red Hat Enterprise Linux for Real Time 7 Installation Guide}
(Red Hat Corporation, November 6, 2015) \label{ref:rhel7_install}
    \item Source for Red Hawk costs in Table \ref{tab:license_costs} was Karl
Weis, Global Supply Chain Program Lead, Raytheon \label{ref:karl}
    \item Source for Red Hat Real-Time costs in Table \ref{tab:license_costs}
was Lynn Bonenfant, IT Program Lead, Raytheon \label{ref:lynn}
    \item \textit{Pull CONFIG\_PREEMPT\_RT stub config from Thomas Gleixner}
commit message from the web view of the Linux git repository at
\url{https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=70e6e1b971e46f5c1c2d72217ba62401a2edc22b}
\label{ref:commit}
\end{enumerate}


%%%%%%%%%%%%%%%%% RedHawk Features %%%%%%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Real-time features from RedHawk in KRFS}
\label{sec:redhawk_features}

KRFS presently is on the Concurrent RedHawk Linux platform. Table
\ref{tab:redhawk_features_1} and Table \ref{tab:redhawk_features_2} list the
Concurrent RedHawk features in the order they appear in Reference
\ref{ref:red_hawk_guide} even though not all of the features are actually
real-time Linux kernel features; for example, hyper-threading is a hardware
setting in Intel CPU and the RCIM card is a piece of hardware and the XFS
filesystem originally from SGI is technically outside the kernel.  All of the
real-time kernel features are inherited from the RT Patch described in Section
\ref{section:rt_patch} except for those based on the RCIM card (device driver,
scheduler, process accounting).

Only the first two features from the list are explicitly used by KRFS source
code.

\begin{table}[H]
    \captionsetup{width=.9\linewidth}
    \caption{RedHawk real-time feature list (Part 1)}
    \resizebox{\textwidth}{!}{%
    \begin{tabular}{p{2.8in}p{1.2in}p{3.6in}}
    \hline
        \textbf{Feature} & \textbf{Used in KRFS} & \textbf{Description} \\
    \hline
        \rowcolor{light-gray} Processor Shielding & \textbf{Yes} & KRFS
currently uses the old syntax from SuSE and Concurrent \emph{shield} instead of
the now-standard Linux command \emph{cset} \\
        \rowcolor{light-gray} Processor Affinity & \textbf{Yes} & KRFS code
uses the POSIX thread interface to set processor affinity \\[4.5mm]
User-level Preemption Control & No & User control of preemption of userspace
synchronization mechanisms like POSIX semaphores using a system function call
\emph{resched\_cntl}.  Makes kernel space preemption mechanism invocable from
userspace. \\
Fast Block/Wake Services & No & A preemptible semaphore in the kernel available
from RT Patch since 2007. \\
RCIM Driver & No & Concurrent sells a PCI card called the Real-time Clock
Interface Module (RCIM).  The card can provide a 400ns clock signal to the
operating system through an interrupt handler to enable a high-resolution timer
feature. \\
Frequency-Based Scheduler (FBS) & No & Source code for the FBS provided by
Concurrent is actually copied without attribution from the original SuSE Linux
Real-Time Extensions released in 2006. \\
/proc Modifications & No & This feature is part of the \emph{usermap} feature
(see below) that can be used by NightStar or even regular users.\\
Kernel Trace Facility & No & This feature is combined with the standard kernel
debuggers to support enhanced kernel debugging features using NightStar \\
ptrace Extensions & No & This feature is combined with the \emph{usermap}
feature (below) to support NightStar debugging) \\
    \hline
    \end{tabular}%
    }
    \label{tab:redhawk_features_1}
\end{table}


\begin{table}[H]
    \captionsetup{width=.9\linewidth}
    \caption{RedHawk real-time feature list (Part 2)}
    \resizebox{\textwidth}{!}{%
    \begin{tabular}{p{2.8in}p{1.2in}p{3.6in}}
    \hline
        \textbf{Feature} & \textbf{Used in KRFS} & \textbf{Description} \\
    \hline
Kernel Preemption & (Yes,built-in) & Kernel Preemption is from the RT Patch \\[4.5mm]
Real-Time Scheduler & (Yes,built-in) & Alternatives to the Linux default
Completely Fair Scheduler (CFS) like priority-based SCHED\_FIFO and SCHED\_RR
(round-robin) have been part of the RT Patch since 2007.  SCHED\_DEADLINE is
available in Linux 3.6 (Red Hat 7.6) and later. \\[4.5mm]
Low Latency Enhancements & (Yes,built-in) & Some kernel tuning configuration
have been compiled in as defaults. \\[4.5mm]
Priority Inheritance & (Yes,built-in) & From the RT Patch. \\[4.5mm]
High Resolution Process Accounting & No & This feature follows from the use of
the RCIM card and driver (above).\\[4.5mm]
Capabilities Support & No & Permission files (\emph{capabilities} files) for
features like the \emph{usermap} and \emph{/proc mmap} features (below).
\\[4.5mm]
Kernel Debuggers & (Yes,built-in) & The built-in kernel debuggers \emph{kdb} and
\emph{kgdb} can be configured to work with NightStar. \\[4.5mm]
Kernel Core Dumps/Crash and Live Analysis & (Yes,built-in) &  This feature
supports NightStar, allowing it to directly map and introspect kernel memory.
\\[4.5mm]
User-level Spin Locks & No &  User control of preemption of spinlocks in the
kernel provided by a special system function call \emph{resched\_cntl}.  Makes
kernel space preemption mechanism invocable from userspace. \\[4.5mm]
usermap and /proc mmap & No & This feature supports NightStar, allowing it to
directly map and introspect any user process.  \\[4.5mm]
Hyper-threading & (Yes,built-in) & This is a setting in the CPU hardware that is
controlled in the BIOS or bootloader that allows in-core multi-processing.
Support in mainline Linux for hyper-threading and symmetric multi-processing
(SMP) has been since 2004.  \\[4.5mm]
XFS Journaling File System & (Yes,built-in) & %
The XFS filesystem was invented at Silicon Graphics (SGI) in 1996 and has been
available for mainline Linux since 2001.%
\\
    \hline
    \end{tabular}%
    }
    \label{tab:redhawk_features_2}
\end{table}

\subsection{KRFS source code changes for a non-RedHawk Linux}

\subsubsection{Shielding CPUs from low-priority system tasks}

CPUs can be shielded from the kernel command-line by using the \emph{isolcpus}
kernel boot parameter to specify one or more CPUs to isolate from the general
Linux kernel scheduler algorithms (Listing \ref{lst:shield_kernel}).


\vspace{0.8cm}
\lstset{
    language=bash,
    basicstyle=\footnotesize\ttfamily,
    linewidth=6in,
    frame=single,
    showstringspaces=false,
    keywordstyle=\ttfamily
}
\begin{minipage}{\linewidth}
\begin{adjustwidth}{0.0in}{0.0in}
\begin{lstlisting}[caption={Shielding CPUs at at kernel boot command-line},
label={lst:shield_kernel}]

# Typical kernel boot command-line specifying isolated CPUs 1-6
#
acpi_enforce_resources=lax intel_iommu=on cma=800M nousb isolcpus=1-6


\end{lstlisting}
\end{adjustwidth}
\end{minipage}
\vspace{0.8cm}

To shield CPUs anytime after kernel boot the \emph{cset} command can be used
(Listing \ref{lst:shield_cmd}).

\vspace{0.8cm}
\lstset{
    language=bash,
    basicstyle=\footnotesize\ttfamily,
    linewidth=6in,
    showstringspaces=false,
    keywordstyle=\ttfamily
}
\begin{adjustwidth}{0.0in}{0.0in}
\begin{lstlisting}[caption={Shielding CPUs at command-line},
label={lst:shield_cmd}]

# Create a cpuset for signal processing named "sigproc" on CPU 1-6
#
$ cset set --cpu=1-6 --set=sigproc


# Create a cpuset named "system" on CPU 0, 7, 8
#
$ cset set --cpu=0,7-8 --set=system


# Assign operating system tasks to "system"
#
$ cset proc --move --fromset=root --toset=system


\end{lstlisting}
\end{adjustwidth}
\vspace{0.8cm}

\subsubsection{CPU affinity for processes and threads}

To pin a process onto a particular cpu or cpuset, instead of using the RedHawk
\emph{run} command, use the standard \emph{taskset} command.

\vspace{0.8cm}
\lstset{
    language=bash,
    basicstyle=\footnotesize\ttfamily,
    linewidth=6in,
    showstringspaces=false,
    keywordstyle=\ttfamily
}
\begin{adjustwidth}{0.0in}{0.0in}
\begin{lstlisting}[caption={Use taskset instead of run},
label={lst:taskset_cmd}]

# In RedHawk, run a program on CPU 5 or 6 (-b stands for "bias")
#
$ run -b 5,6 ./mycommand


# The equivalent of above in conventional Linux
# This command will run the /bin/my-app application on CPU 5 or 6:
#
$ taskset -c 5,6 /bin/my-app



\end{lstlisting}
\end{adjustwidth}
\vspace{0.8cm}

KRFS source code already uses the POSIX \emph{pthreads} to set affinity for
threads, either in the thread attributes object used at thread creation or using
the functions \emph{pthread\_setaffinity\_np()} or
\emph{pthread\_attr\_setaffinity\_np()}.%
\footnote{\url{https://man7.org/linux/man-pages//man3/pthread_attr_setaffinity_np.3.html}}


%%%%%%%%%%%%%%%%% Image creation %%%%%%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Creating the Linux operating system image}
\label{sec:image_creation}

\subsection{RedHawk Architect in K2}

\subsection{Compiling the Linux kernel from source using Raytheon NE tools}



%%%%%%%%%%%%%%%%% Hardening %%%%%%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Hardening the Linux operating system}
\label{sec:image_hardening}

\subsection{Hardening the Linux operating system in K2}

\subsection{Using DevSecOps tools for hardening}



%%%%%%%%%%%%%%%%% Migrating to Red Hat %%%%%%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Migrating to Red Hat Real-Time in K3}
\label{sec:redhat_migration}

\subsection{Source code changes}

\subsection{Build artifact changes}

\subsection{License costs}

Table \ref{tab:license_costs} summarizes license costs (see References
\ref{ref:karl} and \ref{ref:lynn}).

\begin{table}[H]
\captionsetup{width=.9\linewidth}
\caption{License costs}
\resizebox{\textwidth}{!}{%
\begin{tabular}{%
    >{\raggedright\arraybackslash}p{3.2in}%
    >{\raggedleft\arraybackslash}p{1.0in}%
    >{\raggedleft\arraybackslash}p{1.0in}}
\hline
                                 & Red Hawk & Red Hat RT \\
\hline
    Product Maintenance (yearly) & 281,000 & 0 \\
    Development License (yearly) &  20,796 & 2,700 \\
\hline
    Run-time License (perpetual, per-instance) & 300 & 0 \\
    Run-time License (yearly, per-instance) & 400 & 2,700 \\
\hline
\end{tabular}%
}
\label{tab:license_costs}
\end{table}


%%%%%%%%%%%%%%%%% Appendix A: Merge of RT Patch to mainline %%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Appendix A: July 2019 Merge of RT Patch to Linux mainline}

The git commit message from Linus Torvalds merging the real-time patch
into the Linux mainline on July 20, 2019 is below (Reference \ref{ref:commit}).

\begin{verbatim}
Pull CONFIG_PREEMPT_RT stub config from Thomas Gleixner:
 "The real-time preemption patch set exists for almost 15 years now and
  while the vast majority of infrastructure and enhancements have found
  their way into the mainline kernel, the final integration of RT is
  still missing.

  Over the course of the last few years, we have worked on reducing the
  intrusivenness of the RT patches by refactoring kernel infrastructure
  to be more real-time friendly. Almost all of these changes were
  benefitial to the mainline kernel on their own, so there was no
  objection to integrate them.

  Though except for the still ongoing printk refactoring, the remaining
  changes which are required to make RT a first class mainline citizen
  are not longer arguable as immediately beneficial for the mainline
  kernel. Most of them are either reordering code flows or adding RT
  specific functionality.

  But this now has hit a wall and turned into a classic hen and egg
  problem:

     Maintainers are rightfully wary vs. these changes as they make only
     sense if the final integration of RT into the mainline kernel takes
     place.

  Adding CONFIG_PREEMPT_RT aims to solve this as a clear sign that RT
  will be fully integrated into the mainline kernel. The final
  integration of the missing bits and pieces will be of course done with
  the same careful approach as we have used in the past.

  While I'm aware that you are not entirely enthusiastic about that, I
  think that RT should receive the same treatment as any other widely
  used out of tree functionality, which we have accepted into mainline
  over the years.

  RT has become the de-facto standard real-time enhancement and is
  shipped by enterprise, embedded and community distros. It's in use
  throughout a wide range of industries: telecommunications, industrial
  automation, professional audio, medical devices, data acquisition,
  automotive - just to name a few major use cases.

  RT development is backed by a Linuxfoundation project which is
  supported by major stakeholders of this technology. The funding will
  continue over the actual inclusion into mainline to make sure that the
  functionality is neither introducing regressions, regressing itself,
  nor becomes subject to bitrot. There is also a lifely user community
  around RT as well, so contrary to the grim situation 5 years ago, it's
  a healthy project.

  As RT is still a good vehicle to exercise rarely used code paths and
  to detect hard to trigger issues, you could at least view it as a QA
  tool if nothing else"
\end{verbatim}


%%%%%%%%%%%%%%%%% Appendix B: STIG sample for telnet-server %%%%%%%%%%%%%%%%%%%%
%
\newpage
\section{Appendix B: STIG sample for telnet-server}

\lstset{
    language=xml,
    basicstyle=\footnotesize\ttfamily,
    linewidth=7.6in,
    frame=single,
    showstringspaces=false
}
\begin{adjustwidth}{-0.5in}{0.0in}
\begin{lstlisting}[caption={STIG XML sample},
label={lst:stig_xml}]
<Group id="V-72077">
    <title>SRG-OS-000095-GPOS-00049</title>
    <description>&lt;GroupDescription&gt;&lt;/GroupDescription&gt;</description>
    <Rule id="SV-86701r2\_rule" severity="high" weight="10.0">
        <version>RHEL-07-021710</version>
        <title>The Red Hat Enterprise Linux operating system must not have the
telnet-server package installed.</title>
        <description> ooo </description>
        <reference>
            <dc:title>DPMS Target Red Hat 7</dc:title>
            <dc:publisher>DISA</dc:publisher>
            <dc:type>DPMS Target</dc:type>
            <dc:subject>Red Hat 7</dc:subject>
            <dc:identifier>2777</dc:identifier>
        </reference>
        <ident system="http://iase.disa.mil/cci">CCI-000381</ident>
        <fixtext fixref="F-78429r1\_fix">Configure the operating system to
disable non-essential capabilities by removing the telnet-server package from
the system with the following command:

# yum remove telnet-server</fixtext>
        <fix id="F-78429r1\_fix" />
        <check system="C-72309r2\_chk">
            <check-content-ref name="M"
                href="DPMS\_XCCDF\_Benchmark\_RHEL\_7\_STIG.xml" />
            <check-content>Verify the operating system is configured to disable
non-essential capabilities. The most secure way of ensuring a non-essential
capability is disabled is to not have the capability installed.

The telnet service provides an unencrypted remote access service that does not
provide for the confidentiality and integrity of user passwords or the remote
session.

If a privileged user were to log on using this service, the privileged user
password could be compromised.

Check to see if the telnet-server package is installed with the following
command:

# yum list installed telnet-server

If the telnet-server package is installed, this is a finding.</check-content>
        </check>
    </Rule>
</Group>

\end{lstlisting}
\end{adjustwidth}
\vspace{0.8cm}


% %%%%%

\end{document}

